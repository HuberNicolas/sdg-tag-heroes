
# Alembic Workflow: Commands and Workflow

### Check if DB is Up-to-Date
```bash
alembic current  # Shows current DB revision; no changes to db database
alembic heads    # Shows latest migration revision; no changes to db
```
Compare `current` and `heads` outputs.

### Make a Structural Change
1. Modify your models in code (e.g., add a column).
2. Generate migration:
```bash
alembic revision --autogenerate -m "Describe change"
```
This will generate a `HASH_DESCRIPTION`.py file with all the migrations, we can still modify this

### Apply the Migration to DB
```bash
alembic upgrade head
```
This applies the changes to the db. it will also update the entry in the `alembic_version` database to the newest hash

### Rollback a Migration
#### Go down one migration:
```bash
alembic downgrade -1
```

#### Go to a specific revision:
```bash
alembic downgrade <revision_id>
```

#### Go back to the latest migration:
```bash
alembic upgrade head
```


### Dry run
```bash
alembic revision --autogenerate -m "Check model sync with DB"
```

We can then check the migration:

```bash
"""Check model sync with DB

Revision ID: c7d4a360d79f
Revises: 57d57ade7265
Create Date: 2025-01-20 16:58:33.384606

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = 'c7d4a360d79f'
down_revision: Union[str, None] = '57d57ade7265'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    pass
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    pass
    # ### end Alembic commands ###

```
