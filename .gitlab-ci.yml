stages:
  - build
  - test
  - deploy

# Common jobs that run on every push (any branch)
.common-push:
  build-job:
    stage: build
    script:
      - echo "Hello, $GITLAB_USER_LOGIN!"

  test-job1:
    stage: test
    script:
      - echo "This job tests something"

  test-job2:
    stage: test
    script:
      - echo "This job tests something, but takes more time than test-job1."
      - echo "After the echo commands complete, it runs the sleep command for 20 seconds"
      - sleep 20

# Jobs for regular pushes to any branch
.push:
  extends: .common-push

# Jobs specifically for the 'deploy' branch
.deploy-push:
  extends: .common-push
  deploy-prod:
    stage: deploy
    script:
      - echo "This job deploys something from the $CI_COMMIT_BRANCH branch."
    environment: production
    only:
      refs:
        - deploy

# The pipeline that runs for every push (any branch)
.push:
  extends: .common-push

# The pipeline that runs on the 'deploy' branch
.deploy:
  extends: .deploy-push
